# 多选框勾选和取消勾选实现（保留之前的勾选）



:::color1
    最近遇到了多选框的联动问题，之前一直是通过在floating-panel组件中设置smallCheckedList,然后再外部监听smallCheckedList的变化，来修改imageStates和siderCheckedList,但是发现siderCheckedList和imageStates一直更新的不对，出现的情况就是smallCheckedList减少，按理来说这两个也应该减少，但是这两个却不变。现在换了一种写法，就是siderCheckedList和imageStates也在floating-panel组件内部进行setState，写法如下：

:::

```tsx
 const handleCheckboxChange = (item) => {
      setSmallMapCheckedList((prev) => {
        const isChecked = prev.includes(item.id);
        // 先同步 siderCheckedList
        setSiderCheckedList((prevSider) =>
          isChecked
            ? prevSider.filter((i) => i.id !== item.id)
            : prevSider.some((i) => i.id === item.id)
            ? prevSider
            : [...prevSider, item]
        );
        // 再同步 imageStates
        setImageStates((prevImage) => {
          const newState = { ...prevImage };
          if (isChecked) {
            // 取消勾选：删除
            delete newState[item.id];
          } else {
            // 勾选：添加
            newState[item.id] = item; // 或存 item
          }
          return newState;
        });
        // 返回新的 smallMapCheckedList
        return isChecked
          ? prev.filter((id) => id !== item.id)
          : [...prev, item.id];
      });
    };
```



> 更新: 2025-07-07 09:08:56  
> 原文: <https://www.yuque.com/quwaidi-exykz/lv0i4k/qguv7szsfvczslr1>